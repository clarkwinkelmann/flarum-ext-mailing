module.exports=function(t){var a={};function i(o){if(a[o])return a[o].exports;var n=a[o]={i:o,l:!1,exports:{}};return t[o].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=a,i.d=function(t,a,o){i.o(t,a)||Object.defineProperty(t,a,{enumerable:!0,get:o})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,a){if(1&a&&(t=i(t)),8&a)return t;if(4&a&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(i.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&a&&"string"!=typeof t)for(var n in t)i.d(o,n,function(a){return t[a]}.bind(null,n));return o},i.n=function(t){var a=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(a,"a",a),a},i.o=function(t,a){return Object.prototype.hasOwnProperty.call(t,a)},i.p="",i(i.s=9)}([function(t,a){t.exports=flarum.core.compat.app},function(t,a){t.exports=flarum.core.compat.extend},function(t,a){t.exports=flarum.core.compat["components/Button"]},function(t,a){t.exports=flarum.core.compat.Model},function(t,a){t.exports=flarum.core.compat["models/Forum"]},function(t,a){t.exports=flarum.core.compat["utils/UserControls"]},function(t,a){t.exports=flarum.core.compat["components/SessionDropdown"]},function(t,a){t.exports=flarum.core.compat["components/Modal"]},,function(t,a,i){"use strict";i.r(a);var o=i(1),n=i(0),l=i.n(n),e=i(3),r=i.n(e),s=i(4),u=i.n(s),c=i(2),f=i.n(c),p=i(5),d=i.n(p),h=i(6),b=i.n(h);var g=i(7),v=function(t){var a,i;function o(){return t.apply(this,arguments)||this}i=t,(a=o).prototype=Object.create(i.prototype),a.prototype.constructor=a,a.__proto__=i;var n=o.prototype;return n.init=function(){t.prototype.init.call(this),this.loading=!1,this.user=this.props.user,this.forAll=this.props.forAll,this.subject=m.prop(""),this.messageText=m.prop(""),this.forAll?this.submitDisabled=!1:(this.email=m.prop(this.user.email()||""),this.submitDisabled=!this.checkEmail(this.email()))},n.className=function(){return"EmailUserModal Modal--large"},n.title=function(){var t=l.a.translator.trans("kilowhat-mailing.forum.modal_mail.title_text");return this.forAll?t+=" "+l.a.translator.trans("kilowhat-mailing.forum.modal_mail.title_all_text"):t+=" "+this.user.username()+" ("+this.email()+")",t},n.content=function(){return m("div",{className:"Modal-body"},m("form",{className:"Form",onsubmit:this.onsubmit.bind(this)},!this.forAll&&m("div",{className:"Form-group"},m("label",null,l.a.translator.trans("kilowhat-mailing.forum.modal_mail.email_label")),m("input",{type:"text",className:"FormControl",value:this.email(),oninput:m.withAttr("value",this.oninputEmail.bind(this))})),m("div",{className:"Form-group"},m("label",null,l.a.translator.trans("kilowhat-mailing.forum.modal_mail.subject_label")),m("input",{type:"text",className:"FormControl",bidi:this.subject,placeholder:l.a.translator.trans("kilowhat-mailing.forum.modal_mail.default_subject")})),m("div",{className:"Form-group"},m("label",null,l.a.translator.trans("kilowhat-mailing.forum.modal_mail.message_label")),m("textarea",{rows:"10",className:"FormControl",style:"resize: vertical; width: 100%;",bidi:this.messageText})),f.a.component({type:"submit",className:"Button Button--primary EditContactModal-save",loading:this.loading,children:l.a.translator.trans("kilowhat-mailing.forum.modal_mail.submit_button"),disabled:this.submitDisabled})))},n.oninputEmail=function(t){this.email(t),this.submitDisabled=!this.checkEmail(t)},n.checkEmail=function(t){var a=/^[a-z0-9!#$%&'*+\/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+\/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i,i=!0;return this.splitEmails(t).forEach(function(t){a.test(t)||(i=!1)}),i},n.splitEmails=function(t){return(t=t.replace(/\s*/g,"")).split(",")},n.onsubmit=function(t){var a=this;t.preventDefault(),this.loading=!0;var i={emails:this.forAll?[]:this.splitEmails(this.email()),subject:this.subject(),text:this.messageText(),forAll:!!this.forAll};l.a.request({method:"POST",url:l.a.forum.attribute("apiUrl")+"/admin-mail",data:{data:i}}).then(function(){a.hide()},function(t){a.loading=!1,a.onerror(t)})},o}(i.n(g).a);l.a.initializers.add("kilowhat-mailing",function(){u.a.prototype.kilowhatMailingCanMailAll=r.a.attribute("kilowhatMailingCanMailAll"),u.a.prototype.kilowhatMailingCanMailIndividual=r.a.attribute("kilowhatMailingCanMailIndividual"),function(){Object(o.extend)(d.a,"moderationControls",function(t,a){l.a.forum.kilowhatMailingCanMailIndividual()&&t.add("kilowhat-mailing",f.a.component({icon:"fas fa-envelope",children:l.a.translator.trans("kilowhat-mailing.forum.links.mail_individual"),onclick:function(){l.a.modal.show(new v({user:a}))}}))}),Object(o.extend)(b.a.prototype,"items",function(t){l.a.forum.kilowhatMailingCanMailAll()&&t.add("kilowhat-mailing",f.a.component({icon:"fas fa-envelope",children:l.a.translator.trans("kilowhat-mailing.forum.links.mail_all"),onclick:function(){l.a.modal.show(new v({forAll:!0}))}}))});var t=flarum.extensions["flagrow-user-directory"];t&&t.UserDirectoryPage&&Object(o.extend)(t.UserDirectoryPage.prototype,"actionItems",function(t){l.a.forum.kilowhatMailingCanMailAll()&&t.add("kilowhat-mailing",f.a.component({className:"Button",icon:"fas fa-envelope",children:l.a.translator.trans("kilowhat-mailing.forum.links.mail_all"),onclick:function(){l.a.modal.show(new v({forAll:!0}))}}),10)})}()})}]);
//# sourceMappingURL=forum.js.map