{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://@clarkwinkelmann/mailing/webpack/bootstrap","webpack://@clarkwinkelmann/mailing/webpack/runtime/compat get default export","webpack://@clarkwinkelmann/mailing/webpack/runtime/define property getters","webpack://@clarkwinkelmann/mailing/webpack/runtime/hasOwnProperty shorthand","webpack://@clarkwinkelmann/mailing/webpack/runtime/make namespace object","webpack://@clarkwinkelmann/mailing/external root \"flarum.core.compat['forum/app']\"","webpack://@clarkwinkelmann/mailing/external root \"flarum.core.compat['common/extend']\"","webpack://@clarkwinkelmann/mailing/external root \"flarum.core.compat['common/components/Button']\"","webpack://@clarkwinkelmann/mailing/external root \"flarum.core.compat['forum/utils/UserControls']\"","webpack://@clarkwinkelmann/mailing/external root \"flarum.core.compat['forum/components/SessionDropdown']\"","webpack://@clarkwinkelmann/mailing/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://@clarkwinkelmann/mailing/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@clarkwinkelmann/mailing/external root \"flarum.core.compat['common/components/Modal']\"","webpack://@clarkwinkelmann/mailing/external root \"flarum.core.compat['common/components/Switch']\"","webpack://@clarkwinkelmann/mailing/external root \"flarum.core.compat['common/components/LoadingIndicator']\"","webpack://@clarkwinkelmann/mailing/external root \"flarum.core.compat['common/models/Group']\"","webpack://@clarkwinkelmann/mailing/external root \"flarum.core.compat['common/helpers/username']\"","webpack://@clarkwinkelmann/mailing/external root \"flarum.core.compat['common/helpers/icon']\"","webpack://@clarkwinkelmann/mailing/external root \"flarum.core.compat['common/utils/KeyboardNavigatable']\"","webpack://@clarkwinkelmann/mailing/./src/forum/components/SentModal.ts","webpack://@clarkwinkelmann/mailing/external root \"flarum.core.compat['common/Model']\"","webpack://@clarkwinkelmann/mailing/./src/forum/models/Email.ts","webpack://@clarkwinkelmann/mailing/./src/forum/components/EmailUserModal.ts","webpack://@clarkwinkelmann/mailing/external root \"flarum.core.compat['common/extenders']\"","webpack://@clarkwinkelmann/mailing/external root \"flarum.core.compat['common/models/Forum']\"","webpack://@clarkwinkelmann/mailing/./src/forum/extend.ts","webpack://@clarkwinkelmann/mailing/./src/forum/index.ts","webpack://@clarkwinkelmann/mailing/./src/forum/addMailingLinks.ts"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extend'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Button'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/utils/UserControls'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/SessionDropdown'];","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n  return _setPrototypeOf(o, p);\n}","import setPrototypeOf from \"./setPrototypeOf.js\";\nexport default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  setPrototypeOf(subClass, superClass);\n}","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Modal'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Switch'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/LoadingIndicator'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/models/Group'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/helpers/username'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/helpers/icon'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/utils/KeyboardNavigatable'];","import app from 'flarum/forum/app';\nimport Modal, {IInternalModalAttrs} from 'flarum/common/components/Modal';\nimport icon from 'flarum/common/helpers/icon';\n\ninterface SentModalAttrs extends IInternalModalAttrs {\n    recipientsCount: number\n}\n\nexport default class SentModal extends Modal<SentModalAttrs> {\n    className() {\n        return 'KilowhatMailingSentModal Modal--small';\n    }\n\n    title() {\n        return app.translator.trans('clarkwinkelmann-mailing.forum.modal_sent.title_text');\n    }\n\n    content() {\n        return [\n            m('.MailingShipping', icon('fas fa-shipping-fast')),\n            m('.Modal-body', [\n                m('h1', app.translator.trans('clarkwinkelmann-mailing.forum.modal_sent.on_its_way', {\n                    recipientsCount: this.attrs.recipientsCount,\n                })),\n            ]),\n        ];\n    }\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/Model'];","import Model from 'flarum/common/Model';\n\nexport default class Email extends Model {\n    email = Model.attribute<string>('email');\n}\n","import {Vnode} from 'mithril';\nimport app from 'flarum/forum/app';\nimport Modal, {IInternalModalAttrs} from 'flarum/common/components/Modal';\nimport Button from 'flarum/common/components/Button';\nimport Switch from 'flarum/common/components/Switch';\nimport LoadingIndicator from 'flarum/common/components/LoadingIndicator';\nimport Group from 'flarum/common/models/Group';\nimport User from 'flarum/common/models/User';\nimport username from 'flarum/common/helpers/username';\nimport icon from 'flarum/common/helpers/icon';\nimport KeyboardNavigatable from 'flarum/common/utils/KeyboardNavigatable';\nimport SentModal from './SentModal';\nimport Email from '../models/Email';\n\nconst EMAIL_REGEXP = /^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i;\n\ninterface EmailUserModalAttrs extends IInternalModalAttrs {\n    user?: User\n    forAll?: boolean\n}\n\ntype Recipient = Group | User | Email;\n\nexport default class EmailUserModal extends Modal<EmailUserModalAttrs> {\n    sending: boolean = false\n    recipients: Recipient[] = []\n    subject: string = ''\n    messageText: string = ''\n    asHtml: boolean = false\n    searchIndex: number = 0\n    navigator: KeyboardNavigatable = new KeyboardNavigatable()\n    filter: string = ''\n    focused: boolean = false\n    loadingResults: boolean = false\n    searchResults: any[] = []\n    searchTimeout: number = -1\n\n    oninit(vnode: Vnode) {\n        super.oninit(vnode);\n\n        this.recipients = [];\n\n        if (this.attrs.user) {\n            this.recipients.push(this.attrs.user);\n        }\n\n        if (this.attrs.forAll) {\n            const membersGroup = app.store.getById<Group>('groups', Group.MEMBER_ID)!;\n\n            this.recipients.push(membersGroup);\n        }\n\n        this.navigator\n            .when(event => {\n                // Do not handle keyboard when TAB is pressed and there's nothing in field\n                // Without this it's impossible to TAB out of the field\n                return event.key !== 'Tab' || !!this.filter;\n            })\n            .onUp(() => {\n                if (this.searchIndex > 0) {\n                    this.searchIndex--;\n                    m.redraw();\n                }\n            })\n            .onDown(() => {\n                if (this.searchIndex < this.searchResults.length - 1) {\n                    this.searchIndex++;\n                    m.redraw();\n                }\n            })\n            .onSelect(() => {\n                this.selectResult(this.searchResults[this.searchIndex]);\n            })\n            .onRemove(() => {\n                this.recipients.pop();\n            });\n    }\n\n    className() {\n        return 'KilowhatMailingModal Modal--large';\n    }\n\n    title() {\n        return app.translator.trans('clarkwinkelmann-mailing.forum.modal_mail.title_text');\n    }\n\n    onready() {\n        // Override the default autofocus method to focus the title field instead of the first field of the modal\n        this.$('form').find('.js-focus-on-load').first().focus().select();\n    }\n\n    recipientLabel(recipient: Recipient) {\n        switch (recipient.data.type) {\n            case 'users':\n                return m('.RecipientLabel', username(recipient as User));\n            case 'groups':\n                const group = recipient as Group;\n                return m('.RecipientLabel', group.color() ? {\n                    className: 'colored',\n                    style: {\n                        backgroundColor: group.color(),\n                    },\n                } : {}, [\n                    group.icon() ? [\n                        icon(group.icon()!),\n                        ' ',\n                    ] : null,\n                    group.namePlural(),\n                ]);\n            case 'clarkwinkelmann-mailing-emails':\n                return m('.RecipientLabel', (recipient as Email).email());\n        }\n\n        return '[unknown]';\n    }\n\n    searchResultKind(recipient: Recipient) {\n        switch (recipient.data.type) {\n            case 'users':\n                return app.translator.trans('clarkwinkelmann-mailing.forum.recipient_kinds.user');\n            case 'groups':\n                return app.translator.trans('clarkwinkelmann-mailing.forum.recipient_kinds.group');\n            case 'clarkwinkelmann-mailing-emails':\n                return app.translator.trans('clarkwinkelmann-mailing.forum.recipient_kinds.email');\n        }\n\n        return '[unknown]';\n    }\n\n    selectResult(result: Recipient | null) {\n        if (!result) {\n            return;\n        }\n\n        this.recipients.push(result);\n        this.filter = '';\n        this.searchResults = [];\n    }\n\n    content() {\n        return m('.Modal-body', m('form.Form', {\n            onsubmit: this.onsubmit.bind(this),\n        }, [\n            m('.Form-group', [\n                m('label', app.translator.trans('clarkwinkelmann-mailing.forum.modal_mail.recipients_label')),\n                m('.RecipientsInput.FormControl', {\n                    className: this.focused ? 'focus' : '',\n                }, [\n                    m('span.RecipientsInput-selected', this.recipients.map((recipient, index) => m('span.RecipientsInput-recipient', {\n                        onclick: () => {\n                            this.recipients.splice(index, 1);\n                        },\n                        title: this.searchResultKind(recipient),\n                    }, this.recipientLabel(recipient)))),\n                    m('input.FormControl', {\n                        placeholder: app.translator.trans('clarkwinkelmann-mailing.forum.modal_mail.recipients_placeholder'),\n                        value: this.filter,\n                        oninput: (event: InputEvent) => {\n                            this.filter = (event.target as HTMLInputElement).value;\n                            this.performNewSearch();\n                        },\n                        onkeydown: this.navigator.navigate.bind(this.navigator),\n                        onfocus: () => {\n                            this.focused = true;\n                        },\n                        onblur: () => {\n                            this.focused = false;\n                        },\n                        disabled: this.sending,\n                    }),\n                    this.loadingResults ? LoadingIndicator.component({\n                        size: 'small',\n                    }) : null,\n                    this.searchResults.length ? m('ul.Dropdown-menu', this.searchResults.map(\n                        (result, index) => m('li', {\n                            className: this.searchIndex === index ? 'active' : '',\n                            onclick: () => {\n                                this.selectResult(result);\n                            },\n                        }, m('button[type=button]', [\n                            m('span.SearchResultKind', this.searchResultKind(result)),\n                            this.recipientLabel(result),\n                        ]))\n                    )) : null,\n                ]),\n            ]),\n            m('.Form-group', [\n                m('label', app.translator.trans('clarkwinkelmann-mailing.forum.modal_mail.subject_label')),\n                m('input[type=text].FormControl.js-focus-on-load', {\n                    value: this.subject,\n                    oninput: (event: InputEvent) => {\n                        this.subject = (event.target as HTMLInputElement).value;\n                    },\n                    placeholder: app.translator.trans('clarkwinkelmann-mailing.forum.modal_mail.default_subject'),\n                    disabled: this.sending,\n                }),\n            ]),\n            m('.Form-group', [\n                m('label', app.translator.trans('clarkwinkelmann-mailing.forum.modal_mail.message_label')),\n                m('textarea.FormControl', {\n                    rows: 10,\n                    value: this.messageText,\n                    oninput: (event: InputEvent) => {\n                        this.messageText = (event.target as HTMLInputElement).value;\n                    },\n                    disabled: this.sending,\n                }),\n            ]),\n            m('.Form-group', [\n                Switch.component({\n                    state: this.asHtml,\n                    onchange: (value: boolean) => {\n                        this.asHtml = value;\n                    },\n                    disabled: this.sending,\n                }, app.translator.trans('clarkwinkelmann-mailing.forum.modal_mail.as_html_label')),\n            ]),\n            m('.Form-group', [\n                Button.component({\n                    type: 'submit',\n                    className: 'Button Button--primary EditContactModal-save',\n                    loading: this.sending,\n                    disabled: this.recipients.length === 0 || this.messageText === '',\n                }, app.translator.trans('clarkwinkelmann-mailing.forum.modal_mail.submit_button')),\n            ]),\n        ]));\n    }\n\n    performNewSearch() {\n        this.searchIndex = 0;\n\n        const query = this.filter.toLowerCase();\n\n        this.buildSearchResults(query);\n\n        clearTimeout(this.searchTimeout);\n        if (query.length >= 3) {\n            this.searchTimeout = setTimeout(() => {\n                this.loadingResults = true;\n                m.redraw();\n\n                app.store.find('users', {\n                    filter: {q: query},\n                    page: {limit: 5}\n                }).then(() => {\n                    this.loadingResults = false;\n                    this.buildSearchResults(query);\n                    m.redraw();\n                });\n            }, 250) as any;\n        }\n    }\n\n    buildSearchResults(query: string) {\n        if (!query) {\n            this.searchResults = [];\n            return;\n        }\n\n        const results: Recipient[] = [];\n\n        if (app.forum.kilowhatMailingCanMailAll()) {\n            app.store.all<Group>('groups').forEach(group => {\n                // Do not allow Guest group as it wouldn't do anything\n                if (group.id() === Group.GUEST_ID) {\n                    return;\n                }\n\n                if (group.nameSingular().toLowerCase().indexOf(query) !== -1 || group.namePlural().toLowerCase().indexOf(query) !== -1) {\n                    results.push(group);\n                }\n            });\n        }\n\n        app.store.all<User>('users').forEach(user => {\n            if (user.username().toLowerCase().indexOf(query) !== -1) {\n                results.push(user);\n            }\n        });\n\n        if (EMAIL_REGEXP.test(this.filter)) {\n            results.push(app.store.createRecord('clarkwinkelmann-mailing-emails', {\n                attributes: {\n                    email: this.filter,\n                },\n            }));\n        }\n\n        this.searchResults = results.filter(result => {\n            if (result instanceof Email) {\n                return !this.recipients.some(\n                    recipient => (recipient instanceof Email) && recipient.email() === result.email()\n                );\n            }\n\n            return !this.recipients.some(\n                recipient => recipient.data.type === result.data.type && recipient.id() === result.id()\n            );\n        });\n\n        m.redraw();\n    }\n\n    onsubmit(event: SubmitEvent) {\n        event.preventDefault();\n\n        this.sending = true;\n\n        app.request<any>({\n            method: 'POST',\n            url: app.forum.attribute('apiUrl') + '/admin-mail',\n            body: {\n                data: {\n                    recipients: this.recipients.map(recipient => {\n                        if (recipient instanceof Email) {\n                            return {\n                                type: recipient.data.type,\n                                attributes: {\n                                    email: recipient.email(),\n                                },\n                            };\n                        }\n\n                        return {\n                            type: recipient.data.type,\n                            id: recipient.id(),\n                        };\n                    }),\n                    subject: this.subject,\n                    text: this.messageText,\n                    asHtml: this.asHtml,\n                },\n            },\n        }).then(\n            response => {\n                app.modal.show(SentModal, {\n                    recipientsCount: response.recipientsCount,\n                });\n            },\n            response => {\n                this.sending = false;\n                this.onerror(response);\n            }\n        );\n    }\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extenders'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/models/Forum'];","import Extend from 'flarum/common/extenders';\nimport Forum from 'flarum/common/models/Forum';\nimport Email from './models/Email';\n\nexport default [\n    new Extend.Store()\n        .add('clarkwinkelmann-mailing-emails', Email),\n    new Extend.Model(Forum)\n        .attribute('kilowhatMailingCanMailAll')\n        .attribute('kilowhatMailingCanMailIndividual'),\n];\n","import app from 'flarum/forum/app';\nimport addMailingLinks from './addMailingLinks';\n\nexport {default as extend} from './extend';\n\napp.initializers.add('clarkwinkelmann-mailing', () => {\n    addMailingLinks();\n});\n","import {extend} from 'flarum/common/extend';\nimport app from 'flarum/forum/app';\nimport Button from 'flarum/common/components/Button';\nimport UserControls from 'flarum/forum/utils/UserControls';\nimport SessionDropdown from 'flarum/forum/components/SessionDropdown';\nimport EmailUserModal from './components/EmailUserModal';\n\nexport default function () {\n    extend(UserControls, 'moderationControls', (items, user) => {\n        if (app.forum.kilowhatMailingCanMailIndividual()) {\n            items.add('clarkwinkelmann-mailing', Button.component({\n                icon: 'fas fa-envelope',\n                onclick() {\n                    app.modal.show(EmailUserModal, {\n                        user,\n                    });\n                },\n            }, app.translator.trans('clarkwinkelmann-mailing.forum.links.mail_individual')));\n        }\n    });\n\n    extend(SessionDropdown.prototype, 'items', items => {\n        if (app.forum.kilowhatMailingCanMailAll()) {\n            items.add('clarkwinkelmann-mailing', Button.component({\n                icon: 'fas fa-envelope',\n                onclick() {\n                    app.modal.show(EmailUserModal, {\n                        forAll: true,\n                    });\n                },\n            }, app.translator.trans('clarkwinkelmann-mailing.forum.links.mail_all')));\n        }\n    });\n\n    const userDirectory = flarum.extensions['fof-user-directory'];\n    if (userDirectory && userDirectory.UserDirectoryPage) {\n        extend(userDirectory.UserDirectoryPage.prototype, 'actionItems', items => {\n            if (app.forum.kilowhatMailingCanMailAll()) {\n                items.add('clarkwinkelmann-mailing', Button.component({\n                    className: 'Button',\n                    icon: 'fas fa-envelope',\n                    onclick() {\n                        app.modal.show(EmailUserModal, {\n                            forAll: true,\n                        });\n                    },\n                }, app.translator.trans('clarkwinkelmann-mailing.forum.links.mail_all')), 10);\n            }\n        });\n    }\n}\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","flarum","core","compat","_setPrototypeOf","p","setPrototypeOf","bind","__proto__","_inheritsLoose","subClass","superClass","create","constructor","SentModal","_Modal","apply","arguments","_proto","className","title","app","content","m","icon","recipientsCount","this","attrs","Modal","Email","_Model","_this","_len","length","args","Array","_key","concat","email","Model","EMAIL_REGEXP","EmailUserModal","sending","recipients","subject","messageText","asHtml","searchIndex","navigator","KeyboardNavigatable","filter","focused","loadingResults","searchResults","searchTimeout","oninit","vnode","_this2","user","push","forAll","membersGroup","Group","when","event","onUp","redraw","onDown","onSelect","selectResult","onRemove","pop","onready","$","find","first","focus","select","recipientLabel","recipient","data","type","username","group","color","style","backgroundColor","namePlural","searchResultKind","result","_this3","onsubmit","map","index","onclick","splice","placeholder","oninput","target","performNewSearch","onkeydown","navigate","onfocus","onblur","disabled","LoadingIndicator","size","rows","Switch","state","onchange","Button","loading","_this4","query","toLowerCase","buildSearchResults","clearTimeout","setTimeout","q","page","limit","then","_this5","results","forEach","id","nameSingular","indexOf","test","attributes","some","_this6","preventDefault","method","url","body","text","response","onerror","Extend","add","Forum","attribute","extend","UserControls","items","SessionDropdown","userDirectory","extensions","UserDirectoryPage","addMailingLinks"],"sourceRoot":""}